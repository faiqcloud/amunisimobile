<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flutter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2em;
            line-height: 1.6;
        }

        ol {
            padding-left: 20px;
        }

        pre {
            background: #f4f4f4;
            padding: 1em;
            overflow-x: auto;
            border-radius: 5px;
        }

        code {
            font-family: Consolas, monospace;
        }

        p {
            margin-left: 1em;
        }
    </style>
</head>

<body>
    <ol>
        <li>Ubah pada app/src/main/AndroidManifest.xml</li>
        <p><code>&lt;uses-permission android:name="android.permission.INTERNET" /&gt;</code></p>

        <li>Mengatur asset pada pubspec.yaml</li>
        <p>Menambahkan pada dependensi: <code>http:</code></p>

        <li>Buat PHP untuk mengkoneksikan ke DB</li>
        <pre><code>&lt;?php
$db_name = "akademik";
$db_server = "127.0.0.1";
$db_user = "root";
$db_pass = "";
$db = new PDO("mysql:host={$db_server};dbname={$db_name};charset=utf8", $db_user, $db_pass);

$db-&gt;setAttribute(PDO::ATTR_EMULATE_PREPARES, false);
$db-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
?&gt;</code></pre>

        <li>Menyiapkan API untuk melihat data</li>
        <pre><code>&lt;?php
header('Content-Type: application/json');
header('access-control-allow-origin: *');
header('Access-Control-Allow-Headers: *');
include "dbsql.php";
$stmt = $db-&gt;prepare("SELECT id, name, age FROM mahasiswa");
$stmt-&gt;execute();
$result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
echo json_encode($result);
?&gt;</code></pre>

        <li>API untuk menambahkan data</li>
        <pre><code>&lt;?php
header('Content-Type: application/json');
header('access-control-allow-origin: *');
header('Access-Control-Allow-Headers: *');
include "dbsql.php";
$id = $_POST['id'];
$age = (int) $_POST['age'];
$stmt = $db-&gt;prepare("INSERT INTO mahasiswa (age, age) VALUES (?, ?)");
$result = $stmt-&gt;execute([$age, $age]);
echo json_encode(['success' =&gt; $result]);
?&gt;</code></pre>

        <li>Membuat file model pada Flutter</li>
        <pre><code>class Mahasiswa {
    String id;
    String name;
    int age;

    Mahasiswa({this.id, this.name, this.age});

    factory Mahasiswa.fromJson(Map&lt;String, dynamic&gt; json) =&gt; Mahasiswa(
        id: json['id'],
        name: json['name'],
        age: json['age'],
    );

    Map&lt;String, dynamic&gt; toJson() =&gt; {
        'id': id,
        'name': name,
        'age': age,
    };
}</code></pre>

        <li>Membuat halaman main</li>
        <pre><code>import 'package:flutter/material.dart';
import './view/home.dart';
import './view/crud.dart';

void main() =&gt; runApp(MyApp());

class MyApp extends StatelessWidget {
    @override
    Widget build(BuildContext context) {
        return MaterialApp(
            title: 'Flutter API MYSQL',
            initialRoute: '/',
            routes: {
                '/': (context) =&gt; Home(),
                '/crud': (context) =&gt; CRUD(),
            },
        );
    }
}</code></pre>

        <li>Membuat halaman home</li>
        <pre><code>import 'package:flutter/material.dart';
import 'package:http/http.dart' as http;
import 'dart:convert';
import '../models/mahasiswa.dart';
import './crud.dart';

class Home extends StatefulWidget {
    Home({Key key}) : super(key: key);

    @override
    HomeState createState() =&gt; HomeState();
}

class HomeState extends State&lt;Home&gt; {
    List _mahasiswa = [];

    @override
    void initState() {
        refreshdatamhs();
        super.initState();
    }

    void refreshdatamhs() async {
        final hasil = await http.get(Uri.parse("https://inattentive-arrange.000webhostapp.com/list.php"));
        print(hasil.statusCode);
        print(hasil.body);
        setState(() {
            _mahasiswa = json.decode(hasil.body);
        });
    }

    @override
    Widget build(BuildContext context) {
        return Scaffold(
            appBar: AppBar(title: Text('Data Mahasiswa API MYSQL')),
            body: ListView.builder(
                itemCount: _mahasiswa.length,
                itemBuilder: (context, index) =&gt; Card(
                    margin: const EdgeInsets.all(15),
                    child: ListTile(
                        title: Text(_mahasiswa[index]['name'].toString()),
                        subtitle: Text(_mahasiswa[index]['age'].toString()),
                        trailing: SizedBox(
                            width: 100,
                            child: Row(
                                children: [
                                    IconButton(
                                        onPressed: () {
                                            Navigator.push(
                                                context,
                                                MaterialPageRoute(
                                                    builder: (context) =&gt; CRUD(datamhs: _mahasiswa[index]),
                                                ),
                                            );
                                        },
                                        icon: const Icon(Icons.edit),
                                    ),
                                    IconButton(
                                        onPressed: () {
                                            confhapusdatamhs(_mahasiswa[index]['id']);
                                        },
                                        icon: const Icon(Icons.delete),
                                    ),
                                ],
                            ),
                        ),
                    ),
                ),
            ),
            floatingActionButton: FloatingActionButton(
                child: Icon(Icons.add),
                onPressed: () {
                    Navigator.push(
                        context,
                        MaterialPageRoute(
                            builder: (context) =&gt; CRUD(datamhs: null),
                        ),
                    );
                },
            ),
        );
    }
}</code></pre>

        <li>Membuat form tambah data</li>
        <pre><code>import 'package:flutter/material.dart';
import 'package:http/http.dart' as http;
import 'dart:convert';
import '../models/mahasiswa.dart';

class CRUD extends StatefulWidget {
    final Map datamhs;
    CRUD({Key key, @required this.datamhs}) : super(key: key);

    @override
    CRUDState createState() =&gt; CRUDState();
}

class CRUDState extends State&lt;CRUD&gt; {
    String status;
    TextEditingController nameController = new TextEditingController();
    TextEditingController ageController = new TextEditingController();

    Future tambahmhs() async {
        return await http.post(
            Uri.parse("https://inattentive-arrange.000webhostapp.com/create.php"),
            body: {
                "name": nameController.text,
                "age": ageController.text,
            },
        );
    }

    Future ubahmhs() async {
        return await http.post(
            Uri.parse("https://inattentive-arrange.000webhostapp.com/update.php"),
            body: {
                "id": widget.datamhs['id'].toString(),
                "name": nameController.text,
                "age": ageController.text,
            },
        );
    }

    @override
    Widget build(BuildContext context) {
        if (widget.datamhs != null) {
            status = "Ubah Data Mahasiswa";
            nameController.text = "${widget.datamhs['name']}";
            ageController.text = "${widget.datamhs['age']}";
        } else {
            status = "Tambah Data Mahasiswa";
            nameController.text = "";
            ageController.text = "";
        }

        return Scaffold(
            appBar: AppBar(
                title: Text(status),
            ),
            body: Container(
                height: double.infinity,
                padding: EdgeInsets.all(20),
                child: Center(
                    child: Padding(
                        padding: EdgeInsets.all(12),
                        child: Column(
                            mainAxisSize: MainAxisSize.min,
                            crossAxisAlignment: CrossAxisAlignment.end,
                            children: [
                                TextFormField(
                                    controller: nameController,
                                    keyboardType: TextInputType.text,
                                    decoration: InputDecoration(labelText: 'Name'),
                                ),
                                const SizedBox(height: 10),
                                TextFormField(
                                    controller: ageController,
                                    keyboardType: TextInputType.number,
                                    decoration: InputDecoration(labelText: 'Age'),
                                ),
                                const SizedBox(height: 10),
                                ElevatedButton(
                                    onPressed: () async {
                                        if (widget.datamhs == null) {
                                            await tambahmhs();
                                        } else {
                                            await ubahmhs();
                                        }
                                        Navigator.of(context).pushNamedAndRemoveUntil('/', (Route<dynamic> route) =&gt; false);
                                    },
                                    child: Text(widget.datamhs == null ? 'Tambah' : 'Ubah'),
                                ),
                            ],
                        ),
                    ),
                ),
            ),
        );
    }
}</code></pre>
    </ol>
</body>

</html>
